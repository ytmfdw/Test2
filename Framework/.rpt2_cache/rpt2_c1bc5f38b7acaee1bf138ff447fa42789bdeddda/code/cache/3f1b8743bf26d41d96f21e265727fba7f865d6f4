{
  "code": "import Log from \"./Log\";\r\nimport { AppConfig } from \"../AppConfig\";\r\nimport { Apps } from \"./OtherApps\";\r\nimport HomePage from \"../page/HomePage\";\r\nconst SETTING = 'Setting';\r\nconst DB_VERSION = 'version';\r\nexport function getVersionSettings() {\r\n    Log.d('Version:' + AppConfig.VERSION);\r\n    let db = wx.cloud.database();\r\n    if (!db)\r\n        return;\r\n    db.collection(SETTING).where({\r\n        version: AppConfig.VERSION\r\n    }).get().then(res => {\r\n        Log.d(\"获取设置数据：\");\r\n        let data = res.data[0];\r\n        Log.d(data);\r\n        if (data) {\r\n            let settings = data.settings;\r\n            Log.d(settings);\r\n            if (settings) {\r\n                if (settings.gameShowAppRate != void 0) {\r\n                    AppConfig.gameShowAppRate = settings.gameShowAppRate;\r\n                }\r\n                if (settings.icons != void 0) {\r\n                    Apps.icons = settings.icons;\r\n                }\r\n                if (settings.video != void 0) {\r\n                    AppConfig.video = settings.video;\r\n                }\r\n                if (settings.levelMin != void 0) {\r\n                    AppConfig.levelMin = settings.levelMin;\r\n                }\r\n                if (settings.ifShowBonus != void 0) {\r\n                    AppConfig.ifShowBonus = settings.ifShowBonus;\r\n                }\r\n                if (settings.isCheckIp != void 0) {\r\n                    AppConfig.isCheckIp = settings.isCheckIp;\r\n                }\r\n                if (settings.ifAldShare != void 0) {\r\n                    AppConfig.ifAldShare = settings.ifAldShare;\r\n                }\r\n                if (settings.ifShowApps != void 0) {\r\n                    AppConfig.ifShowApps = settings.ifShowApps;\r\n                }\r\n                if (settings.ifVideoErrShare != void 0) {\r\n                    AppConfig.ifVideoErrShare = settings.ifVideoErrShare;\r\n                }\r\n                if (settings.insterCound != void 0) {\r\n                    AppConfig.insterCound = settings.insterCound;\r\n                }\r\n                if (AppConfig.ifShowApps) {\r\n                    HomePage.getSelf().setApps();\r\n                }\r\n            }\r\n        }\r\n        realCheckIp();\r\n    }).catch(err => {\r\n        Log.d(\"查询出错，也要检测IP\");\r\n        realCheckIp();\r\n    });\r\n}\r\nexport function realCheckIp() {\r\n    if (AppConfig.ifShowBonus && AppConfig.isCheckIp) {\r\n        Log.d(\"checkIP=========\");\r\n        checkIP(data => {\r\n            Log.d(data);\r\n            if (data) {\r\n                let obj = JSON.parse(data);\r\n                AppConfig.ifShowBonus = AppConfig.ifShowBonus && ((!obj.data.cityLimit) || (!obj.data.hourLimit));\r\n            }\r\n        });\r\n    }\r\n}\r\nexport function checkIP(callBack) {\r\n    var xhr = new Laya.HttpRequest();\r\n    xhr.http.timeout = 10000;\r\n    xhr.once(Laya.Event.COMPLETE, this, function (data) {\r\n        callBack(data);\r\n    });\r\n    xhr.once(Laya.Event.ERROR, this, err => {\r\n        callBack(null);\r\n    });\r\n    xhr.send(AppConfig.CHECKURL, \"\", \"get\", \"text\");\r\n}\r\n",
  "references": [
    "E:/game/Growup/Laya2Framework/Framework/Framework/src/utils/Log.ts",
    "E:/game/Growup/Laya2Framework/Framework/Framework/src/AppConfig.ts",
    "E:/game/Growup/Laya2Framework/Framework/Framework/src/utils/OtherApps.ts",
    "E:/game/Growup/Laya2Framework/Framework/Framework/src/page/HomePage.ts"
  ]
}
